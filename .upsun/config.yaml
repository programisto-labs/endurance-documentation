# Configuration Upsun pour Endurance Documentation (Docusaurus)

applications:
  # Application Documentation (Docusaurus)
  documentation:
    type: nodejs:22
    container_profile: BALANCED
    build:
      flavor: none
    web:
      commands:
        start: npx http-server build -p $PORT -a 0.0.0.0 -S
      upstream:
        socket_family: tcp
      locations:
        "/":
          passthru: true
        "/img":
          passthru: true
    mounts:
      ".docusaurus":
        source: local
        source_path: .docusaurus
    hooks:
      build: |
        set -eux
        echo "üì¶ Installation des d√©pendances..."
        npm install
        echo "üèóÔ∏è  Build de la documentation Docusaurus..."
        DOCUSAURUS_URL="https://endurancejs.com" npm run build
        echo "‚úÖ Build termin√© avec succ√®s"
      deploy: |
        set -eux
        echo "üöÄ Documentation Endurance d√©ploy√©e avec succ√®s"

# Routes pour l'application
# Routes sp√©cifiques pour endurancejs.com uniquement
# Les routes {default} sont retir√©es car elles √©crasent les routes sp√©cifiques
routes:
  # Route principale avec slash (celle qui sert le contenu)
  "https://endurancejs.com/":
    type: upstream
    upstream: "documentation:http"
  
  # Route sans slash - redirige vers avec slash
  "https://endurancejs.com":
    type: redirect
    to: "https://endurancejs.com/"
  
  # Redirection www vers le domaine principal (avec slash)
  "https://www.endurancejs.com/":
    type: redirect
    to: "https://endurancejs.com/"
  
  # Redirection www vers le domaine principal (sans slash)
  "https://www.endurancejs.com":
    type: redirect
    to: "https://endurancejs.com/"
  
  # Redirection HTTP vers HTTPS (avec slash)
  "http://endurancejs.com/":
    type: redirect
    to: "https://endurancejs.com/"
  
  # Redirection HTTP vers HTTPS (sans slash)
  "http://endurancejs.com":
    type: redirect
    to: "https://endurancejs.com/"